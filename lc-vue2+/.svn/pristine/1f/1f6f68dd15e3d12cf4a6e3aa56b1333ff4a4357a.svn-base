<template lang="html">
    <!-- 车险 -->
    <div id="insurance">
        <header-common :title="viewTitle" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div class="insuranceWrap">
            <div class="showimg">
                <img src="../assets/images/test_insurance.png" alt="">
            </div>
            <div class="info">
                <div class="">
                    <label>姓名</label><input type="text" placeholder="请填写" v-model="name">
                </div>
                <div class="">
                    <label>联系方式</label><input type="text" placeholder="请填写" value="" v-model="mobile">
                </div>
                <div class="">
                    <label>车牌号</label>
                    <input type="text"  placeholder="请填写" v-model="carNum">
                </div>
                <div class="iconfont icon-chevron-copy-copy-copy">
                    <label>原保险公司</label>
                    <input type="text"  placeholder="请选择" readonly v-model="compony" @click="hasSexPicker = 0">
                </div>
                <div class="iconfont icon-chevron-copy-copy-copy">
                    <label>保险到期时间</label>
                    <input type="text" value=""  placeholder="请填写" readonly v-model="timeData" @click="openPicker">
                </div>
            </div>
            <div class="btnWrap">
                <button class="charge" @click='onSubmit'>提交</button>
            </div>
            <div class="sex-picker" v-if="hasSexPicker == 0">
                <div class="mask"></div>
                <div class="pickWrap">
                    <div class="opwrap">
                        <span @click="onsexPicker(1)">取消</span>
                        <span @click="onsexPicker(0)">确定</span>
                    </div>
                    <mt-picker :slots="slots" @change="onPickerChange"></mt-picker>
                </div>
            </div>
            <mt-datetime-picker ref="picker" type="date" :startDate="startDate"  @confirm="closePicker" @cancel="closePicker" > </mt-datetime-picker>
        </div>
    </div>
</template>

<script>
import headerCommon from '../components/header/headerCommon.vue'
import { DatetimePicker, Picker, Toast } from 'mint-ui'
import ajax from './../vueResource.ajax.js'
export default {
    data () {
        return {
            viewTitle: '车险',
            iconType: 'icon-fanhui',
            rightParams: {},
            slots: [{
                flex: 1,
                values: ['阳光车险', '人财保险', '太平洋保险'],
                textAlign: 'center'
            }],
            hasSexPicker: 1,
            startDate: new Date(),
            compony: '',
            time: '',
            timeData: '',
            name: '',
            mobile: '',
            carNum: ''
        }
    },
    computed: {
        // compony () {
        //     return ''
        // }
    },
    components: {
        'header-common': headerCommon,
        'mt-datetime-picker': DatetimePicker,
        'mt-picker': Picker
    },
    beforeCreate () {
        this.$store.commit('hideFoot')
    },
    created () {
        this.getCompanyList()
    },
    methods: {
        onPickerChange (picker, val) {
            this.compony = val[0]
        },
        onsexPicker (val) {
            // 0确定 1取消
            this.hasSexPicker = 1
            if (val === 0) {
            }
        },
        openPicker () {
            this.$refs.picker.open()
        },
        closePicker (val) {
            console.log(val)
            this.$refs.picker.close()
            var date = new Date(val)
            var month = parseInt(date.getMonth()) + 1
            var tmpDate = date.getFullYear() + '-' + month + '-' + date.getDate()
            this.time = new Date(tmpDate)
            this.timeData = tmpDate
        },
        getCompanyList () {
            ajax.ajax({
                'vue': this,
                'port': 'GetAllInsuranceCompanies',
                'type': 'get',
                'statusOk': function (res, v) {
                    // v.$store.commit('setUserInfo', res.data.data)
                    console.log(res.data.data)
                    var tmp = res.data.data
                    var tmpArr = []
                    for (var i = 0; i < tmp.length; i++) {
                        tmpArr.push(tmp[i].name)
                    }
                    v.slots[0].values = tmpArr
                },
                'statusError': function (res, v) {
                    Toast('获取保险公司信息失败')
                }
            })
        },
        onSubmit () {
            if (!this.name) {
                Toast('请填写名字')
            }
            if (!this.mobile) {
                Toast('请填写联系方式')
            }
            if (!this.carNum) {
                Toast('请填写车牌号码')
            }
            if (!this.compony) {
                Toast('请选择原保险公司')
            }
            if (!this.time) {
                Toast('请选择保险到期时间')
            }
            var params = {
                name: this.name,
                phone: this.mobile,
                licensePlate: this.carNum,
                originalInsuranceCompany: this.compony,
                dueTime: this.time
            }
            console.log(params)
            ajax.ajax({
                'vue': this,
                'port': 'CreateInsuranceApplication',
                'type': 'post',
                'req_params': params,
                'statusOk': function (res, v) {
                    // v.$store.commit('setUserInfo', res.data.data)
                    Toast('提交成功')
                    // v.$router.back()
                },
                'statusError': function (res, v) {
                    Toast('保存信息失败')
                }
            })
        }
    }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
#insurance
    .insuranceWrap
        margin-top:45px
        .showimg
            img
                width:100%
        .info
            margin-top:15px
            width:100%
            background-color:#fff
            border-bottom:1px solid #ddd
            div
                height:45px
                line-height:45px
                margin-left:10px
                border-bottom:1px solid #ddd
                position:relative
                &:last-child
                    border-bottom:none
                &:before
                    position:absolute
                    right:10px
                    color:#999
                label
                    display:inline-block
                    width:33%
                    color:#999
                input
                    display:inline-block
                    width:60%
                    height:44px
        .btnWrap
            position:fixed
            bottom:0
            width:100%
            background-color:#fff
            z-index:2
            .charge
                width: 94%
                margin: 20px 3% 10px 3%
                background-color: #c7a770
                height: 44px
                line-height: 44px
                color: #fff
                border: none
                font-size: 18px
        .sex-picker
            width:100%
            height:100%
            position:fixed
            bottom:0
            z-index:5
            .mask
                position:absolute
                height:100%
                width:100%
                background-color:rgba(0,0,0,0.5)
            .pickWrap
                position:absolute
                bottom:0
                width:100%
                z-index:2
                background-color:#fff
                .opwrap
                    overflow:hidden
                    border-bottom:1px solid #ddd
                    span
                        display:block
                        float:left
                        width:50%
                        color:#26a2ff
                        height:40px
                        line-height:40px
                        text-align:center
</style>
