<template lang="html">
    <!--  余额 -->
    <div id="balance">
        <header-common :title="viewTitle" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div class="balanceWrap">
            <div class="money">
                余额<label>￥{{$store.state.user.userInfo.balance}}</label>
                <span class="iconfont icon-chevron-copy-copy-copy-copy-copy-copy"></span>
            </div>
            <div class="chargeSel">
                <ul>
                    <li v-for="item in YHdata" :class="{sel:item.sel}" @click="selCur(item)"><span>￥{{item.amount}}</span><span>(冲{{item.amount}}送{{item.refundAmount}})</span></li>

                    <li class="sr"><input type="text" placeholder="手动输入金额" @click="selCurInput" v-model="inputVal"></li>
                </ul>
            </div>
            <div class="activity">
                <ul>
                    <li v-for="item in chargeActive"><span>1</span>送【{{item.couponTypeId===1?item.couponAmount*10+'折':item.couponTypeId}}理车{{item.couponTypeName}}】 x1</li>
                </ul>
            </div>
            <button class="charge" @click="paymentFun()">立即充值</button>
        </div>
        <recharge v-on:closeRechargeInParent="closeRechargeInParentReal" v-if="rechargeToggle" :chargeData="chargeData"></recharge>
    </div>

</template>

<script>
import headerCommon from '../../components/header/headerCommon.vue'
import recharge from './../recharge.vue'
import { Switch, Toast } from 'mint-ui'
import ajax from './../../vueResource.ajax.js'

export default {
    data () {
        return {
            viewTitle: '我的余额',
            iconType: 'icon-fanhui',
            rightParams: {},
            rechargeToggle: false,
            // 优惠数据
            YHdata: [],
            // 充值活动列表
            chargeActive: [],
            // 充值金额
            inputVal: '',
            // 当前的充值金额ID
            curID: '',
            // 充值参数
            chargeData: {}
        }
    },
    components: {
        'header-common': headerCommon,
        'recharge': recharge
    },
    beforeCreate () {
        this.$store.commit('hideFoot')
    },
    created () {
        this.getYHdata()
        // this.getChargeActive()
    },
    methods: {
        closeRechargeInParentReal () {
            this.rechargeToggle = false
        },
        paymentFun () {
            var params = {}
            if (!this.curID) {
                // 输入 或者 未选择
                this.chargeData = {
                    rechargeAmount: this.inputVal,
                    payTypeId: '',
                    rechargeTempId: ''
                }
            } else {
                //选择
                this.chargeData = {
                    rechargeAmount: '',
                    payTypeId:'',
                    rechargeTempId: this.curID
                }
            }
            this.rechargeToggle = true
            // ajax.ajax({
            //     'vue': this,
            //     'port': 'Recharge',
            //     'type': 'post',
            //     'req_params': params,
            //     'statusOk': function (res, v) {
            //         console.log(res.data.data)
            //      },
            //     'statusError': function (res, v) {
            //     }
            // })
        },
        selCur (val) {
            console.log(val)
            console.log(this.YHdata)
            for (var i = 0; i < this.YHdata.length; i++) {
                this.YHdata[i].sel = false
                if (this.YHdata[i].id === val.id) {
                    this.chargeActive = this.YHdata[i].rechargeCoupons
                }
            }
            val.sel = !val.sel
            this.curID = val.id
            // console.log(this.chargeActive)
        },
        selCurInput () {
            for (var i = 0; i < this.YHdata.length; i++) {
                this.YHdata[i].sel = false
            }
            this.curID = ''
            this.chargeActive = []
        },
        getYHdata () {
            ajax.ajax({
                'vue': this,
                'port': 'GetRechargeTemps',
                'type': 'get',
                'statusOk': function (res, v) {
                    console.log(res.data.data)
                    var dat = res.data.data
                    for (var i = 0; i < dat.length; i++) {
                        dat[i].sel = false
                    }
                    v.YHdata = dat
                 },
                'statusError': function (res, v) {
                }
            })
        }
    }
    // beforeDestroy () {
    //     this.$store.commit('showFoot')
    // }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
#balance
    padding-top:45px
    .balanceWrap
        position:relative
        .money
            height:90px
            border-bottom:1px solid #ddd
            text-align:center
            line-height:90px
            font-size:14px
            background-color:#fff
            color:#666
            span
                position:absolute
                right:10px
            label
                color:#dab96e
                font-size:18px
        .chargeSel
            background-color:#fff
            margin-top:10px
            ul
                overflow:hidden
                padding:10px 0 10px 10px
                li
                    display:block
                    float:left
                    width:30%
                    margin-right:2.5%
                    height:40px
                    border:1px solid #ddd
                    margin-bottom:10px
                    span
                        display:block
                        text-align:center
                        &:first-child
                            padding-top:4px
                            font-size:17px
                        &:last-child
                            font-size:14px
                            color:#999
                .sr
                    width:96%
                    input
                        height:40px
                        width:97%
                        padding-left:3%
                .sel
                    border:2px solid #dab96e
                    margin-left:-2px
                    height:38px
                    color:#dab96e
                    span
                        &:last-child
                            color:#dab96e
        .activity
            padding:10px
            background-color:#fff
            border-bottom:1px solid #ddd
            li
                line-height:30px
                width:100%
                span
                    background-color:#c7a770
                    color:#fff
                    display:inline-block
                    text-align:center
                    width:16px
                    height:16px
                    line-height:16px
                    margin-right:10px
        .charge
            width:94%
            margin:30px 3%
            background-color:#c7a770
            height:44px
            line-height:44px
            color:#fff
            border:none
            font-size:18px


</style>
