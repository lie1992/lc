<template lang="html">
    <!-- 车检报告 -->
    <div id="report">
        <header-common :title="viewTitle" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div id="reportWrap">
            <div class="list" v-for="item in list">
                <p>{{item.name}}</p>
                <p v-if="item.vedioUrl ">视频链接：<span @click="showVideo(item.vedioUrl)">{{item.vedioName?item.vedioName:'车检视频'}}</span></p>
                <p v-if="item.reportUrl">文件链接：<span @click="downReport(item.reportUrl)">车检报告</span></p>
                <p>车检时间：{{item.createOn}}</p>
            </div>
            <div class="sp" v-if="videoToggle">
                <div class="mask" @click="hideVideo" ></div>
                <video ref='video' :src="curVideoUrl"  controls="controls" autoplay>
                    抱歉，该视频无法播放。
                </video>
                <!-- <div ref='video' class="video" >
                    <div v-html="htmlVal">

                    </div>
                </div> -->
            </div>
        </div>
    </div>

</template>

<script>
import headerCommon from '../../components/header/headerCommon.vue'
import ajax from './../../vueResource.ajax.js'

export default {
    data () {
        return {
            viewTitle: '车检报告',
            iconType: 'icon-fanhui',
            rightParams: {},
            list: [],
            isLoading: false,
            page: 1,
            // 没有数据了
            isNo: false,
            videoToggle: false,
            curVideoUrl: '',
            curReportUrl: '',
            htmlVal: ''
        }
    },
    components: {
        'header-common': headerCommon
    },
    beforeCreate () {
        window.scroll(0,0)
        this.$store.commit('hideFoot')
    },
    created () {
        this.getData()
        this.loadMore()
    },
    methods: {
        downReport (url) {
            this.curReportUrl = url
        },
        hideVideo () {
            this.videoToggle = false
            // this.$refs.video.pause()
        },
        showVideo (url) {
            // 'http://www.w3school.com.cn/i/movie.ogg'
            this.curVideoUrl = url
            // this.htmlVal = "<iframe src='http://player.youku.com/embed/XMTg3NzkyODEyNA==' frameborder=0 'allowfullscreen'></iframe>"
            this.videoToggle = true
        },
        loadMore () {
            var that = this
            var oldy, cury
            window.addEventListener('scroll', function (event) {
                oldy = cury
                var scrollTop = document.body.scrollTop
                cury = scrollTop
                var clientHeight
                if (!that.$refs.slideBar) {
                    return
                }
                clientHeight = that.$refs.slideBar.clientHeight
                if (oldy >= cury) {
                    return
                }
                if (scrollTop + window.innerHeight >= clientHeight) {
                    that.getList(that.page)
                }
            })
        },
        getData () {
            if (this.isLoading) {
                return
            }
            if (this.isNo) {
                return
            }
            this.isLoading = true
            var params = '?dto.page=' + this.page + '&dto.pageSize=10'
            ajax.ajax({
                'vue': this,
                'port': 'GetReports',
                'type': 'get',
                'params_url': params,
                'statusOk': function (res, v) {
                    console.log(res.data)
                    v.isLoading = false
                    if (res.data.data.length <= 0) {
                        // window.$.PageDialog.ok('没有更多')
                        v.isNo = true
                        return
                    }
                    var dat = res.data.data
                    for (var i = 0; i < dat.length; i++) {
                        var date = new Date(dat[i].createOn)
                        var month = parseInt(date.getMonth()) + 1
                        var hours = date.getHours() > 8? date.getHours() - 8: 24 + date.getHours() -8
                        var minutes = date.getMinutes() >= 10?date.getMinutes():'0'+date.getMinutes()
                        var seconds = date.getSeconds() >= 10?date.getSeconds():'0'+date.getSeconds()
                        dat[i].createOn = date.getFullYear() + '-' + month + '-' + date.getDate() + ' ' + hours +':'+ minutes +':'+ seconds
                    }
                    v.list = v.list.concat(dat)
                    v.list = dat
                    v.page ++
                },
                'statusError': function (res, v) {
                }
            })
        }
    }

}
</script>

<style lang="stylus" rel="stylesheet/stylus">
#report
    #reportWrap
        margin-top:45px
        .list
            padding-left:85px
            padding-top:8px
            border-bottom:1px solid #ddd
            min-height:82px
            background:url(../../assets/images/icon_report.png) no-repeat
            background-color:#fff
            background-size:50px 50px
            background-position:20px 10px
            p
                width:100%
                white-space:nowrap
                overflow:hidden
                text-overflow:ellipsis
                line-height:25px
                color:#999
                &:first-child
                    color:#333
                span
                    color:#c7a770
    .sp
        position:fixed
        top:0
        left:0
        width:100%
        height:100%
        z-index:100
        .mask
            position:fixed
            top:0
            left:0
            z-index:99
            width:100%
            height:100%
            background-color:rgba(0,0,0,0.5)
        video
            position:fixed
            top:0
            left:0
            z-index:100
            margin-top:45px
            width:100%
    iframe
        width:100%
        /*height:0*/


</style>
