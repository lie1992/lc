<template lang="html">
    <!-- 常见问题 -->
    <div id="issure">
        <header-common :title="viewTitle" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div id="issureWrap">
            <div class="tip">您的车子有什么问题？</div>
            <div class="slide" ref="slideBar">
                <div class="slideBar">
                    <router-link v-for="item in issureList" to=""><span class="iconfont icon-chevron-copy-copy-copy"></span>{{item.question}}</router-link>
                </div>
            </div>
            <div class="call">
                <a><span class="iconfont icon-dianhua"></span>400-8899-688</a>
            </div>
        </div>
    </div>

</template>

<script>
import Bscroll from 'better-scroll'
import headerCommon from '../../components/header/headerCommon.vue'
import ajax from './../../vueResource.ajax.js'
import { Toast } from 'mint-ui'

export default {
    data () {
        return {
            viewTitle: '常见问题',
            iconType: 'icon-fanhui',
            rightParams: {},
            issureList: [],
            isLoading: false,
            page: 1,
            isNo: false
        }
    },
    components: {
        'header-common': headerCommon
    },
    computed: {
        count () {
            return this.$store.state.count
        }
    },
    created () {
        this.getList()
        this.loadMore()
        // this.$nextTick(function () {
            // this._initScroll()
        // })
    },
    beforeCreate () {
        this.$store.commit('hideFoot')
    },
    methods: {
        loadMore () {
            var that = this
            // 上一步坐标 本次坐标
            var oldy, cury
            // 滚动条的高度
            window.addEventListener('scroll', function (event) {
                oldy = cury
                var scrollTop = document.body.scrollTop
                cury = scrollTop
                var clientHeight
                clientHeight = that.$refs.slideBar.clientHeight
                // console.log(clientHeight)
                if (oldy >= cury) {
                    return
                }
                if (scrollTop + window.innerHeight >= clientHeight) {
                    // 触发加载数据
                    // console.log('bottom')
                    that.getList(that.page)
                }
            })
        },
        getList () {
            if (this.isLoading) {
                return
            }
            if (this.isNo) {
                return
            }
            this.isLoading = true
            var params = '?dto.pageIndex=' + this.page + '&dto.pageSize=10'
            ajax.ajax({
                'vue': this,
                'port': 'GetQuestionAndAnswers',
                'type': 'get',
                'params_url': params,
                'statusOk': function (res, v) {
                    console.log(res.data)
                    v.isLoading = false
                    if (res.data.data.length <= 0) {
                        Toast('没有更多')
                        v.isNo = true
                        return
                    }
                    Toast('加载成功')
                    v.issureList = v.issureList.concat(res.data.data)
                    v.page ++
                },
                'statusError': function (res, v) {
                    Toast('获取折扣券失败')
                }
            })
        }
    }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
#issure
    margin-bottom:60px
    #issureWrap
        margin-top:45px
        .tip
            height:45px
            line-height:45px
            padding-left:10px
            position:fixed
            z-index:1
            top:45px
            left:0
            width:100%
            background-color:#f5f5f5
        .slide
            width:100%
            padding-top:45px
            /*position:absolute
            top:90px
            bottom:70px*/
            overflow:hidden
            .slideBar
                a
                    display:block
                    background-color:#fff
                    padding-left:10px
                    padding-right:25px
                    height:44px
                    line-height:44px
                    border-bottom:1px solid #ddd
                    color:#333
                    position:relative
                    margin-bottom:10px
                    overflow:hidden
                    span
                        position:absolute
                        color:#999
                        right:8px
        .call
            position:fixed
            bottom:0
            height:44px
            line-height:44px
            width:100%
            padding:0 3% 10px 3%
            text-align:center
            background-color:#fff
            a
                background-color:#dab96e
                display:block
                width:94%
                color:#fff
                font-size:18px
                font-family:'微软雅黑'
                span
                    font-size:20px
                    padding-right:10px


</style>
