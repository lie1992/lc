<template lang="html">
    <!--  添加车辆 -->
    <div id="addCarInfo">
        <header-common :title="viewTitle" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div id="addCarInfoWrap">
            <div class="info">
                <div class="carName iconfont icon-chevron-copy-copy-copy-copy-copy-copy">
                    <label @click="$router.push('/selectSeries')">请选择车辆</label>
                    <!-- <img src="../../assets/images/test_carlogo.png" />
                    <span>2016款 奥迪A4L 自动 舒适型 典藏版</span> -->
                </div>
                <div class="carNum">
                    <label>车牌号</label>
                    <div class="carNumWrap">
                        <span class="areaID" @click="onSelectAreaOpen">{{selArea}}</span>
                        <input type="text" @blur="onAreaInputBlur" @keyup="onAreaInputKeyup" v-model="areaNum">
                    </div>
                </div>
                <div class=""><label>车架号</label> <input type="text" placeholder="请填写" ></div>
            </div>
            <div class="info">
                <div class="rz">
                    <label @click="onOpen" >车主认证<i class="iconfont icon-wenhaoweiwanchengyanzheng"></i></label>
                    <span class="front">行驶证正面</span>
                    <span class="behind">行驶证反面</span>
                </div>
            </div>
            <div class="info">
                <div><label>总公里数</label> <input type="text" placeholder="请填写"></div>
                <div><label>日行驶公里数</label> <input type="text" placeholder="请填写" ></div>
            </div>
            <div class="info">
                <div class="iconfont icon-chevron-copy-copy-copy-copy-copy-copy" @click="onOpenAreaPicker(0)">
                    <label>设置车险提醒</label><input type="text" readonly placeholder="请选择" v-model="insuranceModel">
                </div>
                <div class="iconfont icon-chevron-copy-copy-copy-copy-copy-copy" @click="onOpenAreaPicker(1)">
                    <label>设置年检提醒</label><input type="text" readonly placeholder="请选择" v-model="inspectModel">
                </div>
            </div>
            <div class="btnWrap">
                <button class="charge" @click="">保存</button>
            </div>

            <div class="sex-picker" v-if="hasAreaPicker == 0">
                <div class="mask"></div>
                <div class="pickWrap">
                    <div class="opwrap">
                        <span @click="onSelectAreaClose(1)">取消</span>
                        <span @click="onSelectAreaClose(0)">确定</span>
                    </div>
                    <mt-picker :slots="slots"  @change="onAreaChange"></mt-picker>
                </div>
            </div>
            <mt-datetime-picker ref="picker" type="date" :startDate="startDate" @confirm="confirmDatePicker" @cancel="closeDataPicker" > </mt-datetime-picker>
        </div>
        <div class="uploadExp" v-if="$store.state.carFloor == 0">
            <header-float :title="viewTitle" :iconType="iconType" ></header-float>
            <div class="imgWrap">
                <p>请上传真实、清晰的行驶证</p>
                <img src="../../assets/images/addcar.jpg" alt="">
            </div>
        </div>
    </div>

</template>

<script>
import headerCommon from '../../components/header/headerCommon.vue'
import headerFloat from '../../components/header/headerFloat.vue'
import {Picker, Toast, DatetimePicker} from 'mint-ui'

export default {
    data () {
        return {
            viewTitle: '添加车辆',
            iconType: 'icon-fanhui',
            rightParams: {},
            slots: [{
                flex: 1,
                values: [ '京', '津', '冀', '晋', '蒙', '辽', '吉', '黑', '沪', '苏',
                    '浙', '皖', '闽', '赣', '鲁', '豫', '鄂', '湘', '粤', '桂', '琼', '川', '贵',
                    '云', '渝', '藏', '陕', '甘', '青', '宁', '新', '港', '澳', '台'],
                textAlign: 'center'
            }],
            hasAreaPicker: 1,
            // selArea 车牌省
            // selAreaTmp 滚动的时候 临时存储车牌省
            // areaNum 车牌输入
            selArea: '浙',
            selAreaTmp: '',
            areaNum: '',
            // 当前打开的datepicker
            curPicker: 0,
            // inspectModel 年检
            // insuranceModel 保险
            inspectModel: '',
            insuranceModel: '',
            startDate: new Date(),
            isShow: 1
        }
    },
    components: {
        'header-common': headerCommon,
        'header-float': headerFloat,
        'mt-picker': Picker,
        'mt-datetime-picker': DatetimePicker
    },
    // computed: {
    //     carFloor () {
    //         return this.$store.state.carFloor
    //     }
    // },
    beforeCreate () {
        this.$store.commit('hideFoot')
    },
    created () {
    },
    methods: {
        onSelectAreaOpen () {
            this.hasAreaPicker = 0
        },
        onSelectAreaClose (val) {
            this.hasAreaPicker = 1
            if (val === 0) {
                this.selArea = this.selAreaTmp
                var areaArr = this.slots[0].values
                for (var i = 0; i < areaArr.length; i++) {
                    if (areaArr[i] === this.selAreaTmp) {
                        // 设置picker默认位置
                        this.slots[0].defaultIndex = i
                    }
                }
            }
        },
        onAreaInputBlur () {
            // console.log(this.areaNum)
            var reg = /^[0-9a-zA-Z]*$/g
            if (!reg.test(this.areaNum)) {
                Toast('车牌号码输入不正确')
            } else {
                var ftxt = this.areaNum.charAt(0)
                ftxt = ftxt.toUpperCase()
                this.areaNum = ftxt + '·' + this.areaNum.substring(1)
            }
        },
        onAreaInputKeyup () {
            // var re = /^[A-Z]{1}[A-Z_0-9]{5}$/
            if (this.areaNum.length > 6) {
                Toast('车牌号码不得超过6位')
            }
        },
        onOpenAreaPicker (val) {
            // 0 保险 1 年检
            this.$refs.picker.open()
            this.curPicker = val
        },
        onAreaChange (picker, val) {
            this.selAreaTmp = val[0]
        },
        confirmDatePicker (val) {
            var date = new Date(val)
            var month = parseInt(date.getMonth()) + 1
            if (this.curPicker === 0) {
                this.insuranceModel = date.getFullYear() + '-' + month + '-' + date.getDate()
            } else {
                this.inspectModel = date.getFullYear() + '-' + month + '-' + date.getDate()
            }
        },
        closeDataPicker () {
        },
        onOpen () {
            this.$store.commit('showCarFloor')
        },
        onClose () {
            this.$store.commit('hideCarFloor')
        }
    }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
#addCarInfo
    #addCarInfoWrap
        margin-top:55px
        margin-bottom:80px
        .info
            margin-top:15px
            width:100%
            background-color:#fff
            border-bottom:1px solid #ddd
            .carName
                height:60px
                line-height:60px
                label
                    width:100%
                img
                    width:40px
                    height:40px
                    display:inline-block
                    vertical-align: middle
                span
                    display:inline-block
                    width:75%
                    height:60px
                    white-space:nowrap
                    overflow:hidden
                    text-overflow:ellipsis
                    vertical-align: middle
            .carNum
                .carNumWrap
                    display:inline-block
                    width:125px
                    height:36px
                    border:none
                    vertical-align: middle
                    margin-left:0
                    background:url(../../assets/images/bg_carID.png) no-repeat
                    background-size:100% 100%
                    color: #fff
                    span
                        display:inline-block
                        line-height:36px
                        text-align:center
                        width:40px
                        height:36px
                        vertical-align:top
                        background:url(../../assets/images/icon_sanxia.png) no-repeat
                        background-position:33px 12px
                    input
                        background:none
                        height:36px
                        width:80px
                        float:right
                        color:#fff
                        overflow:hidden
            .rz
                height:60px
                line-height:60px
                label
                    i
                        color:#dab96e
                span
                    display:inline-block
                    width:67px
                    height:40px
                    background:url(../../assets/images/icon_addbox.png) no-repeat
                    background-size:100% 100%
                    vertical-align:middle
                    color:#bbb
                    font-size:12px
                    text-align:center
                    line-height:60px
            div
                height:45px
                line-height:45px
                margin-left:10px
                border-bottom:1px solid #ddd
                position:relative
                &:last-child
                    border-bottom:none
                &:before
                    position:absolute
                    right:10px
                    color:#999
                label
                    display:inline-block
                    width:33%
                    color:#999
                input
                    display:inline-block
                    width:60%
                    height:44px
        .btnWrap
            position:fixed
            bottom:0
            width:100%
            background-color:#fff
            z-index:2
            .charge
                width: 94%
                margin: 20px 3% 10px 3%
                background-color: #c7a770
                height: 44px
                line-height: 44px
                color: #fff
                border: none
                font-size: 18px
    .sex-picker
        width:100%
        height:100%
        position:fixed
        bottom:0
        z-index:5
        .mask
            position:absolute
            height:100%
            width:100%
            background-color:rgba(0,0,0,0.5)
        .pickWrap
            position:absolute
            bottom:0
            width:100%
            z-index:2
            background-color:#fff
            .opwrap
                overflow:hidden
                border-bottom:1px solid #ddd
                span
                    display:block
                    float:left
                    width:50%
                    color:#26a2ff
                    height:40px
                    line-height:40px
                    text-align:center
    .uploadExp
        position:fixed
        width:100%
        height:100%
        top:0
        background-color:#353535
        z-index:6
        .imgWrap
            height:300px
            font-size:16px
            color:#fff
            vertical-align:middle
            margin-top:120px
            text-align:center
            img
                width:94%
                margin:10px 3%
</style>
