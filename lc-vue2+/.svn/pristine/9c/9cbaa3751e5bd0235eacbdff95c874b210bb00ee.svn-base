<template lang="html">
    <div id="setBX" >
        <!-- 设置保险时间 -->
        <header-common :title="$store.state.user.curCarNum" :iconType="iconType" :rightParams="rightParams"></header-common>
        <div class="setBXWrap">
            <div class="info">
                <div class="iconfont icon-chevron-copy-copy-copy-copy-copy-copy" @click="onOpenAreaPicker()">
                    <label>设置车险提醒</label><input type="text" readonly placeholder="请选择" v-model="insuranceModel">
                </div>
                <!-- <div class="iconfont icon-chevron-copy-copy-copy-copy-copy-copy" @click="onOpenAreaPicker(1)">
                    <label>设置年检提醒</label><input type="text" readonly placeholder="请选择" v-model="inspectModel">
                </div> -->
            </div>
        </div>
        <mt-datetime-picker ref="picker" type="date" :startDate="startDate" @confirm="confirmDatePicker" @cancel="closeDataPicker" > </mt-datetime-picker>
    </div>
</template>

<script  type="text/ecmascript-6">
import Bscroll from 'better-scroll'
import headerCommon from 'components/header/headerCommon.vue'
import {Toast, DatetimePicker} from 'mint-ui'
import ajax from './../vueResource.ajax.js'

export default {
    data () {
        return {
            iconType: 'icon-fanhui',
            rightParams: {
                // path: '/cart',
                // desc: '完成'
            },
            insuranceModel: '',
            insuranceData: '',
            startDate: new Date(),
            isShow: 1
        }
    },
    components: {
        'header-common': headerCommon,
        'mt-datetime-picker': DatetimePicker
    },
    created () {
    },
    computed: {
        defaultCar () {
            return this.$store.state.user.userDefaultCar
        }
    },
    methods: {
        onOpenAreaPicker () {
            this.$refs.picker.open()
        },
        confirmDatePicker (val) {
            var date = new Date(val)
            var month = parseInt(date.getMonth()) + 1
            this.insuranceModel = date.getFullYear() + '-' + month + '-' + date.getDate()
            this.insuranceData = new Date(this.insuranceModel)
            var params = {
                id: this.$store.state.user.userDefaultCar.id,
                carInsuranceRemind: this.insuranceData,
                isCarInsuranceNotify: true
            }
            ajax.ajax({
                'vue': this,
                'port': 'UpdateCarInsurance',
                'type': 'post',
                'req_params': params,
                'statusOk': function (res, v) {
                    if (res.data.success === true) {
                        v.defaultCar.isCarInsuranceNotify = true
                        v.$router.back()
                        window.$.PageDialog.ok('您已开启车险到期提醒')
                    }
                },
                'statusError': function (res, v) {
                }
            })
        },
        closeDataPicker () {}
    },
    beforeCreate () {
        this.$store.commit('hideFoot')
    }
}
</script>

<style lang="stylus" rel="stylesheet/stylus">
@import '../assets/css/cssCommon.styl'
#setBX
    .setBXWrap
        padding-top:55px
        .info
            width: 100%
            background-color: #fff
            border-bottom: 1px solid #ddd
            .iconfont
                height:45px
                line-height:45px
                position:relative
                padding:0 10px
                &:before
                    position: absolute
                    right: 10px
                    color: #999
                label
                    display: inline-block
                    width: 33%
                    color: #999
                input
                    display: inline-block
                    width: 60%
                    height: 44px
                    text-align:right
</style>
